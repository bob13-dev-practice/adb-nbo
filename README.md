# adb-nbo
ì‹¤ìŠµì„ í†µí•´ network byte order, host byte orderì— ëŒ€í•œ ë³€í™˜ì´ ì™œ í•„ìš”í•œì§€ ì´í•´í•œë‹¤.
</br>
ê³¼ì œ ì¶œì²˜: https://gitlab.com/gilgil/sns/-/wikis/byte-order/report-add-nbo
</br>
</br>
## Byte Order

ì»´í“¨í„°ëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•  ë•Œ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ ì €ì¥í•œë‹¤. ì—°ì†ë˜ëŠ” ë°”ì´íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì €ì¥í•´ì•¼ í•˜ëŠ”ë°, ì´ë¥¼ ë°”ì´íŠ¸ ì €ì¥ ìˆœì„œ(byte order)ë¼ í•œë‹¤. ë°”ì´íŠ¸ê°€ ì €ì¥ë˜ëŠ” ìˆœì„œì— ë”°ë¼ `Big-Endian`ê³¼ `Little-Endian`ì˜ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.

ğŸ’¡ **ì—”ë””ì•ˆ(Endian)**: ì»´í“¨í„° ë©”ëª¨ë¦¬ì™€ ê°™ì€ 1ì°¨ì› ê³µê°„ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ì—°ì†ëœ ëŒ€ìƒì„ ë°°ì—´í•˜ëŠ” ë°©ë²•
</br></br>

### Big Endian (ë¹…ì—”ë””ì•ˆ)

- ë‚®ì€ ì£¼ì†Œì— ë°ì´í„°ì˜ ë†’ì€ ë°”ì´íŠ¸ë¶€í„° ì €ì¥í•˜ëŠ” ë°©ì‹ì´ë‹¤.
- í‰ì†Œ ìˆ«ìë¥¼ ì‚¬ìš©í•˜ëŠ” ì„ í˜• ë°©ì‹ê³¼ ê°™ì€ ë°©ì‹ì´ë©°, ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ìˆœì„œ ê·¸ëŒ€ë¡œ ì½ì„ ìˆ˜ ìˆì–´ ì´í•´í•˜ê¸°ê°€ ì‰½ë‹¤.
- ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ì™€ í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ ì˜¤ë” ëª¨ë‘ **ì •ë°©í–¥**ì´ë‹¤.
- ex) arm ì¼ë¶€
</br></br>

### Little Endian (ë¦¬í‹€ì—”ë””ì•ˆ)

- ë‚®ì€ ì£¼ì†Œì— ë°ì´í„°ì˜ ë‚®ì€ ë°”ì´íŠ¸ë¶€í„° ì €ì¥í•˜ëŠ” ë°©ì‹ì´ë‹¤.
- í‰ì†Œ ìˆ«ìë¥¼ ì‚¬ìš©í•˜ëŠ” ì„ í˜• ë°©ì‹ê³¼ëŠ” ë°˜ëŒ€ë¡œ ì½ì–´ì•¼ í•œë‹¤.
- ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ëŠ” **ì •ë°©í–¥**, í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ ì˜¤ë”ëŠ” **ì—­ë°©í–¥**ì´ë‹¤.
- ex) intel
</br></br>

### NBO(Network Byte Order)

Network Levelì—ì„œ ë°”ì´íŠ¸ë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ê¸°ë³¸ì ìœ¼ë¡œ Big Endian ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©° Little Endianì„ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ì´ìš©í•˜ë ¤ë©´ Big Endianìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤.
</br></br>

### HBO(Host Byte Order)

Host Levelì—ì„œ ë°”ì´íŠ¸ë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, CPUì— ë”°ë¼ Big Endianê³¼ Little Endianìœ¼ë¡œ ë‚˜ë‰œë‹¤.
</br></br>

### HBOì—ì„œ NBOë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•

Cì–¸ì–´ì—ì„œëŠ”Â `#include <netinet/in.h>`Â í—¤ë”ë¥¼ ì´ìš©í•˜ì—¬ ì‰½ê²Œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

í•´ë‹¹ í—¤ë”ë¥¼ ì´ìš©í•œë‹¤ë©´ ì»´íŒŒì¼ëŸ¬ê°€ í•´ë‹¹ CPUê°€ Little Endianì¸ì§€, Big Endianì¸ì§€ ì•Œì•„ì„œ íŒë‹¨í•˜ê³ , ë‚´ë¶€ì ìœ¼ë¡œ ì ì ˆí•˜ê²Œ ë™ì‘í•  ìˆ˜ ìˆê²Œ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

| Conversion | C Function | Size |
| --- | --- | --- |
| NBO to HBO | uint16_tÂ ntohs(uint16_t netshort); | 2 Byte |
| HBO to NBO | uint16_tÂ htons(uint16_t hostshort); | 2 Byte |
| NBO to HBO | uint32_tÂ ntohl(uint32_t netlong); | 4 Byte |
| HBO to NBO | uint32_tÂ htonl(uint32_t hostlong); | 4 Byte |

</br>

### ì‹¤ìŠµ 1) 16bit ntohs êµ¬í˜„

ë„¤íŠ¸ì›Œí¬ ë²„í¼ë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ê°€ ì‹œìŠ¤í…œ ë‚´ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥ë  ë•Œ ë¦¬í‹€ì—”ë””ì•ˆ ë°©ì‹ì— ì˜í•´ `0x3412`ë¡œ ì €ì¥ëœë‹¤. ì´ë¥¼ ë¹…ì—”ë””ì•ˆìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

```cpp
uint16_t my_ntohs(uint16_t n) {
		int n1 = n & 0xFF00; // 0x3400
		int n2 = n & 0x00FF; // 0x0012
		
		n1 >>= 8; // 0x0034
		n2 <<= 8; // 0x1200
		
		return n1 | n2; // 0x1234
}

void  write_0x1234() {
		uint8_t network_buffer[] = { 0x12, 0x34 };
		uint16_t* p = reinterpret_cast<uint16_t*>(network_buffer);
		uint16_t n = my_ntohs(*p); // TODO
		printf("16 bit number=0x%x\n", n);
}

int main() {
		write_0x1234();
}
```

```
16 bit number=0x1234
```
</br>

### ì‹¤ìŠµ 2) 32bit nthol êµ¬í˜„

ë„¤íŠ¸ì›Œí¬ ë²„í¼ë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ê°€ ì‹œìŠ¤í…œ ë‚´ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥ë  ë•Œ ë¦¬í‹€ì—”ë””ì•ˆ ë°©ì‹ì— ì˜í•´ `0x78563412`ë¡œ ì €ì¥ëœë‹¤. ì´ë¥¼ ë¹…ì—”ë””ì•ˆìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

```cpp
uint32_t my_ntohl(uint32_t n){
		int n1 = n & 0xFF000000; // 0x78000000
    int n2 = n & 0x00FF0000; // 0x00560000
		int n3 = n & 0x0000FF00; // 0x00003400
		int n4 = n & 0x000000FF; // 0x00000012

		n1 >>= 24; // 0x00000078
		n2 >>= 8; // 0x00005600
    n3 <<= 8; // 0x00340000
    n4 <<= 24; // 0x12000000
		
		return n1 | n2 | n3 | n4; // 0x12345678
}

void  write_0x12345678() {
	uint8_t network_buffer[] = { 0x12, 0x34, 0x56, 0x78 };
	uint32_t* p = reinterpret_cast<uint32_t*>(network_buffer);
	uint32_t n = my_ntohl(*p); // TODO
	printf("32 bit number=0x%x\n", n);
}

int main() {
    write_0x12345678();
}
```

```
32 bit number=0x12345678
```
</br>

### Reference
- https://www.tcpschool.com/c/c_refer_endian
- https://gitlab.com/gilgil/sns/-/wikis/byte-order/byte-order
- https://wonit.tistory.com/544
